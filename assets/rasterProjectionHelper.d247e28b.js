var Z=Object.defineProperty,_=Object.defineProperties;var nn=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var tn=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable;var F=(n,t,a)=>t in n?Z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,G=(n,t)=>{for(var a in t||(t={}))tn.call(t,a)&&F(n,a,t[a]);if($)for(var a of $(t))an.call(t,a)&&F(n,a,t[a]);return n},T=(n,t)=>_(n,nn(t));import{hr as B,eI as on,ab as O,cu as I,U as rn,cx as X,m as z,c0 as v,c7 as sn,v as en,hs as E}from"./externalRenderers.e9b2a64d.js";const L=5e-4;function ln(n,t,a){return!sn(n,t,a)}function S(n,t,a){const r=ln(n,t,a);if(r&&!B())throw new en("rasterprojectionhelper-project","projection engine is not loaded");return r}const H=function(n,t,a){const r=(n[0]+n[4]+n[4*t.cols]+n[4*t.cols+4])/4,i=(n[1]+n[5]+n[4*t.rows+1]+n[4*t.rows+5])/4,o=(n[4*t.cols]-n[0]+n[4*t.cols+4]-n[4])/a[0]*.5,s=(n[4*t.cols+1]-n[1]+n[4*t.cols+5]-n[5])/a[1]*.5;return[o===0||isNaN(o)?0:Math.abs(r-n[2*t.rows+2])/Math.abs(o),s===0||isNaN(s)?0:Math.abs(i-n[2*t.rows+3])/Math.abs(s)]},cn={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},k=32,q=4,fn=q;async function yn(){if(B())return null;await on()}function Mn(n,t,a){return S(n.spatialReference,t)?a?E(t,n.spatialReference,n):E(n.spatialReference,t,n):null}function dn(n,t,a,r=null){if(n.spatialReference.equals(t))return n;S(n.spatialReference,t,r);const i=a.center,o=new O({xmin:i.x-n.x/2,xmax:i.x+n.x/2,ymin:i.y-n.y/2,ymax:i.y+n.y/2,spatialReference:n.spatialReference}),s=I(o,t,r);return rn(s)?null:{x:s.xmax-s.xmin,y:s.ymax-s.ymin}}function J(n,t=.01){return X(n)?t/X(n):0}function Q(n,t,a=null,r=!0){const i=n.spatialReference;if(i.equals(t))return n;S(i,t,a);const o=I(n,t,a);if(r&&t.isGeographic){const[s,e]=A(i,!0),c=J(i);c&&s!=null&&e!=null&&(Math.abs(n.x-s)<c&&Math.abs(180-o.x)<L?o.x-=360:Math.abs(n.x-e)<c&&Math.abs(180+o.x)<L&&(o.x+=360))}return o}function un(n,t,a=null){const r=n[0].spatialReference;return r.equals(t)?n:(S(r,t,a),I(n,t,a))}function U(n){const t=P(n[0].spatialReference);if(n.length<2||!z(t))return n[0];let{xmin:a,xmax:r,ymin:i,ymax:o}=n[0];for(let s=1;s<n.length;s++){const e=n[s];r=e.xmax+t*s,i=Math.min(i,e.ymin),o=Math.max(o,e.ymax)}return new O({xmin:a,xmax:r,ymin:i,ymax:o,spatialReference:n[0].spatialReference})}function gn(n,t,a=null,r=!0){if(n.spatialReference.equals(t))return n;const i=xn(n),o=P(n.spatialReference,!0);return!z(o)||i===0?D(n,t,a,r):U(n.clone().normalize().map(s=>D(s,t,a,r)))}function D(n,t,a=null,r=!0){const i=n.spatialReference;if(i.equals(t))return n;S(i,t,a);const o=I(n,t,a);let[s,e]=A(i,!0);if(o&&r&&i.isWebMercator&&t.isGeographic&&s!=null&&e!=null){const h=.001,f=1e3;if(Math.abs(n.xmin-s)<h&&Math.abs(e-n.xmax)>f&&Math.abs(180-o.xmax)<L){o.xmin=-180;const m=[];m.push(new v(n.xmax,n.ymin,i)),m.push(new v(n.xmax,(n.ymin+n.ymax)/2,i)),m.push(new v(n.xmax,n.ymax,i));const u=m.map(x=>Q(x,t,a)).filter(x=>!isNaN(x==null?void 0:x.x)).map(x=>x.x);o.xmax=Math.max.apply(null,u)}if(Math.abs(n.xmax-e)<h&&Math.abs(s-n.xmin)>f&&Math.abs(180+o.xmin)<L){o.xmax=180;const m=[];m.push(new v(n.xmin,n.ymin,i)),m.push(new v(n.xmin,(n.ymin+n.ymax)/2,i)),m.push(new v(n.xmin,n.ymax,i));const u=m.map(x=>Q(x,t,a)).filter(x=>!isNaN(x==null?void 0:x.x)).map(x=>x.x);o.xmin=Math.min.apply(null,u)}}[s,e]=A(t,!0);const c=J(t);return c&&s!=null&&e!=null&&o&&(Math.abs(o.xmin-s)<c&&(o.xmin=s),Math.abs(o.xmax-e)<c&&(o.xmax=e)),o}function P(n,t=!1){const a=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*a:n.wkid&&n.isGeographic?360:2*cn[n.wkid]||null}function A(n,t=!1){const a=[],r=P(n,t);return z(r)&&(a.push(-r/2),a.push(r/2)),a}function K(n,t,a,r){let i=(n-t)/a;return i-Math.floor(i)!=0?i=Math.floor(i):r&&(i-=1),i}function xn(n,t=!1){const a=P(n.spatialReference);if(!z(a))return 0;const r=t?0:-(a/2);return K(n.xmax,r,a,!0)-K(n.xmin,r,a,!1)}function wn(n){const t=n.storageInfo.origin.x,a=P(n.spatialReference,!0);if(!z(a))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const r=a/2,{nativePixelSize:i,storageInfo:o,extent:s}=n,{maximumPyramidLevel:e,blockWidth:c,pyramidScalingFactor:h}=o;let f=i.x;const m=[],u=z(n.transform)&&n.transform.type==="gcs-shift",x=t+(u?0:r),d=u?a-t:r-t;for(let g=0;g<=e;g++){const p=(s.xmax-t)/f/c,w=p-Math.floor(p)==0?p:Math.ceil(p),M=d/f/c,l=M-Math.floor(M)==0?M:Math.ceil(M),R=Math.floor(x/f/c),y=Math.round(x/f)%c,j=(c-Math.round(d/f)%c)%c;m.push({resolutionX:f,blockWidth:c,datsetColumnCount:w,worldColumnCountFromOrigin:l,leftMargin:y,rightPadding:j,originColumnOffset:R}),f*=h}return{originX:t,halfWorldWidth:r,pyramidsInfo:m,hasGCSSShiftTransform:u}}function Rn(n){const t=n.isAdaptive&&n.spacing==null,a=n.spacing||[k,k];let r=V(n),i={cols:r.size[0]+1,rows:r.size[1]+1},o=H(r.offsets,i,a);const s=(o[0]+o[1])/2,e=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;return t&&(e||s>fn)&&(r=V(T(G({},n),{spacing:[q,q]})),i={cols:r.size[0]+1,rows:r.size[1]+1},o=H(r.offsets,i,a)),r.error=o,r.coefficients=mn(r.offsets,i,e),r}function V(n){const{projectedExtent:t,srcBufferExtent:a,pixelSize:r,datumTransformation:i,rasterTransform:o}=n,s=t.spatialReference,e=a.spatialReference;S(s,e);const{xmin:c,ymin:h,xmax:f,ymax:m}=t,u=P(e),x=n.hasWrapAround||(o==null?void 0:o.type)==="gcs-shift",d=n.spacing||[k,k],g={x:d[0]*r.x,y:d[1]*r.y},p={cols:Math.ceil((f-c)/g.x-.1/d[0])+1,rows:Math.ceil((m-h)/g.y-.1/d[1])+1},w=g.x,M=g.y,l=[];let R,y=0;const j=[];for(let N=0;N<p.cols;N++)for(let C=0;C<p.rows;C++)j.push(new v({x:c+w*N,y:m-M*C,spatialReference:s}));const Y=un(j,e,i);for(let N=0;N<p.cols;N++){const C=[];for(let W=0;W<p.rows;W++){let b=Y[N*p.rows+W];o&&(b=o.inverseTransform(b)),C.push(b),N>0&&x&&b&&R[W]&&z(u)&&b.x<R[W].x&&(b.x+=u),b?(l.push((b.x-a.xmin)/(a.xmax-a.xmin)),l.push((a.ymax-b.y)/(a.ymax-a.ymin))):(l.push(NaN),l.push(NaN),y++)}R=C}return{offsets:l,error:null,coefficients:null,outofBoundPointCount:y,spacing:d,size:[p.cols-1,p.rows-1]}}function mn(n,t,a){const{cols:r,rows:i}=t,o=new Float32Array((r-1)*(i-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),e=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let c=0;c<r-1;c++){for(let h=0;h<i-1;h++){let f=c*i*2+2*h;const m=n[f],u=n[f+1],x=n[f+2],d=n[f+3];f+=2*i;const g=n[f],p=n[f+1],w=n[f+2],M=n[f+3];let l=0,R=12*(h*(r-1)+c);for(let y=0;y<3;y++)o[R++]=s[l++]*m+s[l++]*x+s[l++]*w;l=0;for(let y=0;y<3;y++)o[R++]=s[l++]*u+s[l++]*d+s[l++]*M;l=0;for(let y=0;y<3;y++)o[R++]=e[l++]*m+e[l++]*g+e[l++]*w;l=0;for(let y=0;y<3;y++)o[R++]=e[l++]*u+e[l++]*p+e[l++]*M}if(a)for(let h=0;h<o.length;h++)isNaN(o[h])&&(o[h]=-1)}return o}function bn(n){const t=n.clone().normalize();return t.length===1?t[0]:U(t)}function vn(n,t,a){const{storageInfo:r,pixelSize:i}=t;let o,s=!1;const{pyramidResolutions:e}=r;if(z(e)&&e.length){const u=(n.x+n.y)/2,x=e[e.length-1],d=(x.x+x.y)/2,g=(i.x+i.y)/2;if(u<=g)o=0;else if(u>=d)o=e.length,s=u/d>8;else{let w,M=g;for(let l=1;l<=e.length;l++){if(w=(e[l-1].x+e[l-1].y)/2,u<=w){u===w?o=l:a==="down"?(o=l-1,s=u/M>8):o=a==="up"||u-M>w-u||u/M>2?l:l-1;break}M=w}}const p=o===0?i:e[o-1];return{pyramidLevel:o,pyramidResolution:new v({x:p.x,y:p.y,spatialReference:t.spatialReference}),excessiveReading:s}}const c=Math.log(n.x/i.x)/Math.LN2,h=Math.log(n.y/i.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;o=a==="down"?Math.floor(Math.min(c,h)):a==="up"?Math.ceil(Math.max(c,h)):Math.round((c+h)/2),o<0?o=0:o>f&&(s=o>f+3,o=f);const m=2**o;return{pyramidLevel:o,pyramidResolution:new v({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}export{vn as A,xn as G,Rn as L,P,dn as R,wn as T,yn as d,gn as j,bn as q,Q as v,Mn as w,ln as x};
//# sourceMappingURL=rasterProjectionHelper.d247e28b.js.map

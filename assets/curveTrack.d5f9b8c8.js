import{reactive as Zt,ref as jt,onMounted as Dt,openBlock as Lt,createElementBlock as Ft,isRef as Ot}from"vue";import{B as Ct}from"./base3D.6463c8aa.js";import{t as kt}from"./threeUniversal.9ce15fef.js";import{c as s,aO as Ht,ai as rt,aP as qt,aQ as Gt,J as Rt,R as mt,al as Wt,p as ut,O as lt,V as c,Q as A,M as ct,a6 as wt,b as g,F as x,B as ht,aR as yt,aS as et,ab as Z,aM as Nt,i as W,d as Ut,D as Bt,aT as Vt,m as $t,ac as Jt,a7 as Kt,h as te}from"./three.module.3b505d30.js";import{F as ee}from"./FontLoader.7c810b15.js";import{T as ne}from"./TextGeometry.d7612f96.js";import"./OrbitControls.5e199169.js";import"./stats.module.0fc722e3.js";const q=4,G=1024,Q=4;function ie(a=1){const e=new Float32Array(G*Q*a*q),i=new qt(e,G,Q*a,Gt,Rt);return i.wrapS=mt,i.wrapY=mt,i.magFilter=Wt,i.needsUpdate=!0,i}function oe(a,e,i=0){const n=Math.floor(G*(Q/4));e.arcLengthDivisions=n/2,e.updateArcLengths();const o=e.getSpacedPoints(n),l=e.computeFrenetFrames(n,!0);for(let t=0;t<n;t++){const r=Math.floor(t/G),p=t%G;let h=o[t];nt(a,p,h.x,h.y,h.z,0+r+Q*i),h=l.tangents[t],nt(a,p,h.x,h.y,h.z,1+r+Q*i),h=l.normals[t],nt(a,p,h.x,h.y,h.z,2+r+Q*i),h=l.binormals[t],nt(a,p,h.x,h.y,h.z,3+r+Q*i)}a.needsUpdate=!0}function nt(a,e,i,n,o,l){const t=a.image,{data:r}=t,p=q*G*l;r[e*q+p+0]=i,r[e*q+p+1]=n,r[e*q+p+2]=o,r[e*q+p+3]=1}function se(a){return{spineTexture:{value:a},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}}}function ae(a,e,i=1){a.__ok||(a.__ok=!0,a.onBeforeCompile=n=>{if(n.__modified)return;n.__modified=!0,Object.assign(n.uniforms,e);const o=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${Q*i}.;
		float textureStacks = ${Q/4}.;

		${n.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
void main() {
#include <beginnormal_vertex>

vec4 worldPos = modelMatrix * vec4(position, 1.);

bool bend = flow > 0;
float xWeight = bend ? 0. : 1.;

#ifdef USE_INSTANCING
float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
#else
float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
#endif

mt = mod(mt, textureStacks);
float rowOffset = floor(mt);

#ifdef USE_INSTANCING
rowOffset += instanceMatrix[3][1] * ${Q}.;
#endif

vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
mat3 basis = mat3(a, b, c);

vec3 transformed = basis
	* vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
	+ spinePos;

vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);n.vertexShader=o})}class re{constructor(e,i=1){const n=e.clone(),o=ie(i),l=se(o);n.traverse(function(t){(t instanceof s||t instanceof Ht)&&(t.material=t.material.clone(),ae(t.material,l,i))}),this.curveArray=new Array(i),this.curveLengthArray=new Array(i),this.object3D=n,this.splineTexure=o,this.uniforms=l}updateCurve(e,i){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const n=i.getLength();this.uniforms.spineLength.value=n,this.curveLengthArray[e]=n,this.curveArray[e]=i,oe(this.splineTexure,i,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}new rt;const F=new ut,_=new c,j=new c,f=new A,xt={X:new c(1,0,0),Y:new c(0,1,0),Z:new c(0,0,1)},pt={type:"change"},bt={type:"mouseDown"},vt={type:"mouseUp",mode:null},gt={type:"objectChange"};class _t extends lt{constructor(e,i){super();i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const n=new Et;this._gizmo=n,this.add(n);const o=new It;this._plane=o,this.add(o);const l=this;function t(w,m){let y=m;Object.defineProperty(l,w,{get:function(){return y!==void 0?y:m},set:function(u){y!==u&&(y=u,o[w]=u,n[w]=u,l.dispatchEvent({type:w+"-changed",value:u}),l.dispatchEvent(pt))}}),l[w]=m,o[w]=m,n[w]=m}t("camera",e),t("object",void 0),t("enabled",!0),t("axis",null),t("mode","translate"),t("translationSnap",null),t("rotationSnap",null),t("scaleSnap",null),t("space","world"),t("size",1),t("dragging",!1),t("showX",!0),t("showY",!0),t("showZ",!0);const r=new c,p=new c,h=new A,P=new A,T=new c,Y=new A,C=new c,k=new c,E=new c,S=0,b=new c;t("worldPosition",r),t("worldPositionStart",p),t("worldQuaternion",h),t("worldQuaternionStart",P),t("cameraPosition",T),t("cameraQuaternion",Y),t("pointStart",C),t("pointEnd",k),t("rotationAxis",E),t("rotationAngle",S),t("eye",b),this._offset=new c,this._startNorm=new c,this._endNorm=new c,this._cameraScale=new c,this._parentPosition=new c,this._parentQuaternion=new A,this._parentQuaternionInv=new A,this._parentScale=new c,this._worldScaleStart=new c,this._worldQuaternionInv=new A,this._worldScale=new c,this._positionStart=new c,this._quaternionStart=new A,this._scaleStart=new c,this._getPointer=le.bind(this),this._onPointerDown=he.bind(this),this._onPointerHover=ce.bind(this),this._onPointerMove=pe.bind(this),this._onPointerUp=de.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;F.setFromCamera(e,this.camera);const i=dt(this._gizmo.picker[this.mode],F);i?this.axis=i.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){F.setFromCamera(e,this.camera);const i=dt(this._plane,F,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,bt.mode=this.mode,this.dispatchEvent(bt)}}pointerMove(e){const i=this.axis,n=this.mode,o=this.object;let l=this.space;if(n==="scale"?l="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(l="world"),o===void 0||i===null||this.dragging===!1||e.button!==-1)return;F.setFromCamera(e,this.camera);const t=dt(this._plane,F,!0);if(!!t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),l==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),o.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(l==="local"&&(o.position.applyQuaternion(f.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.position.applyQuaternion(this._quaternionStart)),l==="world"&&(o.parent&&o.position.add(_.setFromMatrixPosition(o.parent.matrixWorld)),i.search("X")!==-1&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.parent&&o.position.sub(_.setFromMatrixPosition(o.parent.matrixWorld))));else if(n==="scale"){if(i.search("XYZ")!==-1){let r=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(r*=-1),j.set(r,r,r)}else _.copy(this.pointStart),j.copy(this.pointEnd),_.applyQuaternion(this._worldQuaternionInv),j.applyQuaternion(this._worldQuaternionInv),j.divide(_),i.search("X")===-1&&(j.x=1),i.search("Y")===-1&&(j.y=1),i.search("Z")===-1&&(j.z=1);o.scale.copy(this._scaleStart).multiply(j),this.scaleSnap&&(i.search("X")!==-1&&(o.scale.x=Math.round(o.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(o.scale.y=Math.round(o.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(o.scale.z=Math.round(o.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const r=20/this.worldPosition.distanceTo(_.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_.copy(this.rotationAxis).cross(this.eye))*r):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(xt[i]),_.copy(xt[i]),l==="local"&&_.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(_.cross(this.eye).normalize())*r),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&i!=="E"&&i!=="XYZE"?(o.quaternion.copy(this._quaternionStart),o.quaternion.multiply(f.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),o.quaternion.copy(f.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),o.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(pt),this.dispatchEvent(gt)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(vt.mode=this.mode,this.dispatchEvent(vt)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(pt),this.dispatchEvent(gt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return F}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}_t.prototype.isTransformControls=!0;function le(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function ce(a){if(!!this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function he(a){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function pe(a){!this.enabled||this.pointerMove(this._getPointer(a))}function de(a){!this.enabled||(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function dt(a,e,i){const n=e.intersectObject(a,!0);for(let o=0;o<n.length;o++)if(n[o].object.visible||i)return n[o];return!1}const it=new Vt,d=new c(0,1,0),Pt=new c(0,0,0),St=new rt,ot=new A,st=new A,X=new c,Mt=new rt,N=new c(1,0,0),O=new c(0,1,0),U=new c(0,0,1),at=new c,B=new c,V=new c;class Et extends lt{constructor(){super();this.type="TransformControlsGizmo";const e=new ct({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new wt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const o=i.clone();o.opacity=.5;const l=e.clone();l.color.setHex(16711680);const t=e.clone();t.color.setHex(65280);const r=e.clone();r.color.setHex(255);const p=e.clone();p.color.setHex(16711680),p.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const P=e.clone();P.color.setHex(255),P.opacity=.5;const T=e.clone();T.opacity=.25;const Y=e.clone();Y.color.setHex(16776960),Y.opacity=.25,e.clone().color.setHex(16776960);const k=e.clone();k.color.setHex(7895160);const E=new g(0,.04,.1,12);E.translate(0,.05,0);const S=new x(.08,.08,.08);S.translate(0,.04,0);const b=new ht;b.setAttribute("position",new yt([0,0,0,1,0,0],3));const w=new g(.0075,.0075,.5,3);w.translate(0,.25,0);function m(M,$){const I=new W(M,.0075,3,64,$*Math.PI*2);return I.rotateY(Math.PI/2),I.rotateX(Math.PI/2),I}function y(){const M=new ht;return M.setAttribute("position",new yt([0,0,0,1,1,1],3)),M}const u={X:[[new s(E,l),[.5,0,0],[0,0,-Math.PI/2]],[new s(E,l),[-.5,0,0],[0,0,Math.PI/2]],[new s(w,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new s(E,t),[0,.5,0]],[new s(E,t),[0,-.5,0],[Math.PI,0,0]],[new s(w,t)]],Z:[[new s(E,r),[0,0,.5],[Math.PI/2,0,0]],[new s(E,r),[0,0,-.5],[-Math.PI/2,0,0]],[new s(w,r),null,[Math.PI/2,0,0]]],XYZ:[[new s(new et(.1,0),T.clone()),[0,0,0]]],XY:[[new s(new x(.15,.15,.01),P.clone()),[.15,.15,0]]],YZ:[[new s(new x(.15,.15,.01),p.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new x(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},D={X:[[new s(new g(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new s(new g(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s(new g(.2,0,.6,4),n),[0,.3,0]],[new s(new g(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s(new g(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new s(new g(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new s(new et(.2,0),n)]],XY:[[new s(new x(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new s(new x(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new x(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},L={START:[[new s(new et(.01,2),o),null,null,null,"helper"]],END:[[new s(new et(.01,2),o),null,null,null,"helper"]],DELTA:[[new Z(y(),o),null,null,null,"helper"]],X:[[new Z(b,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Z(b,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Z(b,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={XYZE:[[new s(m(.5,1),k),null,[0,Math.PI/2,0]]],X:[[new s(m(.5,.5),l)]],Y:[[new s(m(.5,.5),t),null,[0,0,-Math.PI/2]]],Z:[[new s(m(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new s(m(.75,1),Y),null,[0,Math.PI/2,0]]]},Tt={AXIS:[[new Z(b,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},At={XYZE:[[new s(new Nt(.25,10,8),n)]],X:[[new s(new W(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new s(new W(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new s(new W(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new s(new W(.75,.1,2,24),n)]]},Qt={X:[[new s(S,l),[.5,0,0],[0,0,-Math.PI/2]],[new s(w,l),[0,0,0],[0,0,-Math.PI/2]],[new s(S,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new s(S,t),[0,.5,0]],[new s(w,t)],[new s(S,t),[0,-.5,0],[0,0,Math.PI]]],Z:[[new s(S,r),[0,0,.5],[Math.PI/2,0,0]],[new s(w,r),[0,0,0],[Math.PI/2,0,0]],[new s(S,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new s(new x(.15,.15,.01),P),[.15,.15,0]]],YZ:[[new s(new x(.15,.15,.01),p),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new x(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s(new x(.1,.1,.1),T.clone())]]},Xt={X:[[new s(new g(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new s(new g(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s(new g(.2,0,.6,4),n),[0,.3,0]],[new s(new g(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s(new g(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new s(new g(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new s(new x(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new s(new x(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new x(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s(new x(.2,.2,.2),n),[0,0,0]]]},Yt={X:[[new Z(b,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Z(b,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Z(b,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function z(M){const $=new lt;for(const I in M)for(let H=M[I].length;H--;){const v=M[I][H][0].clone(),J=M[I][H][1],K=M[I][H][2],tt=M[I][H][3],zt=M[I][H][4];v.name=I,v.tag=zt,J&&v.position.set(J[0],J[1],J[2]),K&&v.rotation.set(K[0],K[1],K[2]),tt&&v.scale.set(tt[0],tt[1],tt[2]),v.updateMatrix();const ft=v.geometry.clone();ft.applyMatrix4(v.matrix),v.geometry=ft,v.renderOrder=1/0,v.position.set(0,0,0),v.rotation.set(0,0,0),v.scale.set(1,1,1),$.add(v)}return $}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=z(u)),this.add(this.gizmo.rotate=z(R)),this.add(this.gizmo.scale=z(Qt)),this.add(this.picker.translate=z(D)),this.add(this.picker.rotate=z(At)),this.add(this.picker.scale=z(Xt)),this.add(this.helper.translate=z(L)),this.add(this.helper.rotate=z(Tt)),this.add(this.helper.scale=z(Yt)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:st;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let o=[];o=o.concat(this.picker[this.mode].children),o=o.concat(this.gizmo[this.mode].children),o=o.concat(this.helper[this.mode].children);for(let l=0;l<o.length;l++){const t=o[l];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(r*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.position.copy(this.worldPositionStart),t.visible=!!this.axis,this.axis==="X"&&(f.setFromEuler(it.set(0,0,0)),t.quaternion.copy(n).multiply(f),Math.abs(d.copy(N).applyQuaternion(n).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(f.setFromEuler(it.set(0,0,Math.PI/2)),t.quaternion.copy(n).multiply(f),Math.abs(d.copy(O).applyQuaternion(n).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(f.setFromEuler(it.set(0,Math.PI/2,0)),t.quaternion.copy(n).multiply(f),Math.abs(d.copy(U).applyQuaternion(n).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(f.setFromEuler(it.set(0,Math.PI/2,0)),d.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(St.lookAt(Pt,d,O)),t.quaternion.multiply(f),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),_.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(_),t.visible=this.dragging):(t.quaternion.copy(n),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}if(t.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"){const p=.99,h=.2;t.name==="X"&&Math.abs(d.copy(N).applyQuaternion(n).dot(this.eye))>p&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(d.copy(O).applyQuaternion(n).dot(this.eye))>p&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(d.copy(U).applyQuaternion(n).dot(this.eye))>p&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(d.copy(U).applyQuaternion(n).dot(this.eye))<h&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(d.copy(N).applyQuaternion(n).dot(this.eye))<h&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(d.copy(O).applyQuaternion(n).dot(this.eye))<h&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)}else this.mode==="rotate"&&(ot.copy(n),d.copy(this.eye).applyQuaternion(f.copy(n).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(St.lookAt(this.eye,Pt,O)),t.name==="X"&&(f.setFromAxisAngle(N,Math.atan2(-d.y,d.z)),f.multiplyQuaternions(ot,f),t.quaternion.copy(f)),t.name==="Y"&&(f.setFromAxisAngle(O,Math.atan2(d.x,d.z)),f.multiplyQuaternions(ot,f),t.quaternion.copy(f)),t.name==="Z"&&(f.setFromAxisAngle(U,Math.atan2(d.y,d.x)),f.multiplyQuaternions(ot,f),t.quaternion.copy(f)));t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis||this.axis.split("").some(function(p){return t.name===p}))&&(t.material.color.setHex(16776960),t.material.opacity=1)}super.updateMatrixWorld(e)}}Et.prototype.isTransformControlsGizmo=!0;class It extends s{constructor(){super(new Ut(1e5,1e5,2,2),new ct({visible:!1,wireframe:!0,side:Bt,transparent:!0,opacity:.1,toneMapped:!1}));this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),at.copy(N).applyQuaternion(i==="local"?this.worldQuaternion:st),B.copy(O).applyQuaternion(i==="local"?this.worldQuaternion:st),V.copy(U).applyQuaternion(i==="local"?this.worldQuaternion:st),d.copy(B),this.mode){case"translate":case"scale":switch(this.axis){case"X":d.copy(this.eye).cross(at),X.copy(at).cross(d);break;case"Y":d.copy(this.eye).cross(B),X.copy(B).cross(d);break;case"Z":d.copy(this.eye).cross(V),X.copy(V).cross(d);break;case"XY":X.copy(V);break;case"YZ":X.copy(at);break;case"XZ":d.copy(V),X.copy(B);break;case"XYZ":case"E":X.set(0,0,0);break}break;case"rotate":default:X.set(0,0,0)}X.length()===0?this.quaternion.copy(this.cameraQuaternion):(Mt.lookAt(_.set(0,0,0),X,d),this.quaternion.setFromRotationMatrix(Mt)),super.updateMatrixWorld(e)}}It.prototype.isTransformControlsPlane=!0;const ge={setup(a){let e=Zt({base3D:{}}),i=new ut,n=jt(null);const o=1,l=0;let t=[],r,p,h,P,T;const Y=new te;let C=l;Dt(()=>{e.base3D=new Ct(n.value),T=e.base3D.orbitControls,T.update(),T.addEventListener("change",b),kt.addFloor(e.base3D.scene),k(),E(),S()});function k(){const m=[{x:100,y:0,z:-100},{x:100,y:0,z:100},{x:-100,y:0,z:100},{x:-100,y:0,z:-100}],y=new x(5,5,5),u=new ct;for(const L of m){const R=new s(y,u);R.position.copy(L),t.push(R),e.base3D.scene.add(R)}r=new $t(t.map(L=>L.position)),r.curveType="centripetal",r.closed=!0;const D=r.getPoints(50);h=new Jt(new ht().setFromPoints(D),new wt({color:16711680})),e.base3D.scene.add(h)}function E(){new ee().load("/fonts/STSong_Regular.json",y=>{const u=new ne("H",{font:y,size:20,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:2,bevelSize:1,bevelOffset:0,bevelSegments:5});u.rotateX(Math.PI);const D=new Kt({color:65535}),L=new s(u,D);p=new re(L),p.updateCurve(0,r),e.base3D.scene.add(p.object3D)}),P=new _t(e.base3D.camera,e.base3D.renderer.domElement),P.addEventListener("change",b),P.addEventListener("dragging-changed",y=>{if(!y.value){const u=r.getPoints(50);h.geometry.setFromPoints(u),p.updateCurve(0,r)}T.enabled=!y.value})}function S(){if(requestAnimationFrame(S),C===o){i.setFromCamera(Y,e.base3D.camera),C=l;const m=i.intersectObjects(t,!1);if(m.length){const y=m[0].object;P.attach(y),e.base3D.scene.add(P)}}p&&p.moveAlongCurve(-.001),b()}function b(){e.base3D.renderer.domElement.addEventListener("pointerdown",w)}function w(m){C=o,Y.x=m.clientX/window.innerWidth*2-1,Y.y=-(m.clientY/window.innerHeight)*2+1}return(m,y)=>(Lt(),Ft("div",{id:"sceneContainer",ref:(u,D)=>{D.sceneContainer=u,Ot(n)?n.value=u:n=u}},null,512))}};export{ge as default};
//# sourceMappingURL=curveTrack.d5f9b8c8.js.map

{"version":3,"file":"ExportImageParameters.6811c936.js","sources":["../../node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{isSome as t}from\"../../core/maybe.js\";import{property as i}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";import{getLayerFloorFilterClause as n,combineFloorsDefinitionExpression as y}from\"../../views/support/floorFilterUtils.js\";const m={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let c=class extends(s(r)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=n(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(m[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){var e;const r=!(null==(e=this.floors)||!e.length),s=this.visibleSublayers.filter((e=>null!=e.definitionExpression||r&&null!=e.floorInfo));return s.length?JSON.stringify(s.reduce(((e,r)=>{const s=n(this.floors,r),i=t(s)?y(s,r):r.definitionExpression;return e[r.id]=i,e}),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,o=0===r.minScale||t<=r.minScale,a=0===r.maxScale||t>=r.maxScale;r.visible&&(i||o&&a)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([i({readOnly:!0})],c.prototype,\"dynamicLayers\",null),e([i()],c.prototype,\"floors\",void 0),e([i({readOnly:!0})],c.prototype,\"hasDynamicLayers\",null),e([i()],c.prototype,\"layer\",null),e([i({readOnly:!0})],c.prototype,\"layers\",null),e([i({readOnly:!0})],c.prototype,\"layerDefs\",null),e([i({type:Number})],c.prototype,\"scale\",void 0),e([i(a)],c.prototype,\"timeExtent\",void 0),e([i({readOnly:!0})],c.prototype,\"version\",null),e([i({readOnly:!0})],c.prototype,\"visibleSublayers\",null),c=e([o(\"esri.layers.mixins.ExportImageParameters\")],c);export{c as ExportImageParameters};\n"],"names":["s","r","l","t","y","i","a","o"],"mappings":"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"}
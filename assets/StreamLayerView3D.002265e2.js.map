{"version":3,"file":"StreamLayerView3D.002265e2.js","sources":["../../node_modules/@arcgis/core/layers/graphics/controllers/StreamController.js","../../node_modules/@arcgis/core/views/layers/StreamLayerView.js","../../node_modules/@arcgis/core/views/3d/layers/StreamLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../Graphic.js\";import r from\"../../../core/Accessor.js\";import{HandleOwnerMixin as o}from\"../../../core/HandleOwner.js\";import{isSome as s}from\"../../../core/maybe.js\";import{EsriPromiseMixin as i}from\"../../../core/Promise.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as n}from\"../../../core/accessorSupport/decorators/subclass.js\";import c from\"../data/StreamFeatureManager.js\";import{createConnection as p}from\"../sources/connections/createConnection.js\";import{EventedSet as h}from\"../../../views/3d/support/EventedSet.js\";import{featureGeometryTypeKebabDictionary as d}from\"../../../geometry/support/typeUtils.js\";var l;const u=2500;let m=l=class extends t{getObjectId(){return this.objectId}clone(){return new l({objectId:this.objectId,...this.cloneProperties()})}};e([a({type:Number,json:{read:!0}})],m.prototype,\"objectId\",void 0),m=l=e([n(\"esri.layers.graphics.controllers.StreamGraphic\")],m);class y{constructor(e){this.onUpdate=e,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(e){this._idToGraphic.set(e.objectId,e)}get(e){return this._idToGraphic.get(e)}forEach(e){this._idToGraphic.forEach(e)}removeById(e){const t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._idToGraphic.size}}let f=class extends(o(i(r))){constructor(){super(...arguments),this._updateInfo={websocket:0,client:0},this.graphics=new h}initialize(){this.addResolvingPromise(this.layer.when((()=>this._startup())))}destroy(){this.clear()}clear(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()}get updating(){return!this.connection||\"connected\"===this.connection.connectionStatus}_startup(){const{parsedUrl:e,spatialReference:t,definitionExpression:r,geometryDefinition:o,objectIdField:s,timeInfo:i,purgeOptions:a,maxReconnectionAttempts:n,maxReconnectionInterval:h,updateInterval:l}=this.layer,m=d.toJSON(this.layer.geometryType),f=t,g=this.layerView.view.spatialReference,_={geometry:o,where:r};this.clear(),this._set(\"connection\",p(e,f,g,m,_,n,h)),this._outSpatialReference=g.toJSON(),this.store=new y(this._onUpdate.bind(this)),this.featuresManager=new c(this.store,s,i.toJSON(),a),this.handles.add([this.connection.on(\"feature\",(e=>this._onFeature(e))),this.layer.watch(\"definitionExpression\",(()=>this._startup())),this.layer.watch(\"geometryDefinition\",(()=>this._startup())),this.layer.watch(\"purgeOptions\",(()=>this._startup()))]);let I=performance.now();this._updateIntervalId=setInterval((()=>{const e=performance.now(),t=e-I;if(t>u){I=e;const r=Math.round(this._updateInfo.client/(t/1e3)),o=Math.round(this._updateInfo.websocket/(t/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit(\"update-rate\",{client:r,websocket:o})}this.featuresManager.checkForUpdates()}),l)}_onFeature(e){this._updateInfo.websocket++,this.layerView.hasEventListener(\"data-received\")&&this.layerView.emit(\"data-received\",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{s(e.geometry)&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._outSpatialReference);const t=m.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch{}}_onUpdate(e,t){s(t)&&this.graphics.removeMany(t),s(e)&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}};e([a()],f.prototype,\"connection\",void 0),e([a()],f.prototype,\"layer\",void 0),e([a()],f.prototype,\"layerView\",void 0),e([a({readOnly:!0})],f.prototype,\"updating\",null),f=e([n(\"esri.layers.graphics.controllers.StreamController\")],f);const g=f;export{g as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import e from\"../../layers/support/FeatureFilter.js\";const s=s=>{let c=class extends s{constructor(...r){super(...r),this.connectionError=null,this.connectionStatus=\"disconnected\",this.filter=null}};return r([o({readOnly:!0})],c.prototype,\"connectionError\",void 0),r([o({aliasOf:\"controller.connection.connectionStatus\",readOnly:!0})],c.prototype,\"connectionStatus\",void 0),r([o({type:e})],c.prototype,\"filter\",void 0),c=r([t(\"esri.layers.mixins.StreamLayerView\")],c),c};export{s as StreamLayerView,s as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Error.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as t}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../layers/graphics/controllers/StreamController.js\";import i from\"../../../rest/support/Query.js\";import{FeatureLikeLayerView3D as a}from\"./FeatureLikeLayerView3D.js\";import{LayerView3D as n}from\"./LayerView3D.js\";import p from\"../../layers/LayerView.js\";import{StreamLayerView as l}from\"../../layers/StreamLayerView.js\";let c=class extends(l(a(n(p)))){constructor(){super(...arguments),this.type=\"stream-3d\",this.updatePolicy=0,this.hasZ=!0,this.hasM=!1}get connectionError(){const r=this.get(\"controller.connection.errorString\");if(r)return new e(\"stream-controller\",r)}createQuery(){return new i({outFields:[\"*\"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryLatestObservations(r,e){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(r),null==e?void 0:e.signal)}createController(){return new s({layer:this.layer,layerView:this})}beforeSetController(){}};r([o({readOnly:!0})],c.prototype,\"updatePolicy\",void 0),r([o({readOnly:!0})],c.prototype,\"connectionError\",null),r([o()],c.prototype,\"controller\",void 0),r([o({readOnly:!0})],c.prototype,\"hasZ\",void 0),r([o({readOnly:!0})],c.prototype,\"hasM\",void 0),c=r([t(\"esri.views.3d.layers.StreamLayerView3D\")],c);const y=c;export{y as default};\n"],"names":["t","a","n","o","i","r","h","d","p","y","c","s","e","l"],"mappings":"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"}
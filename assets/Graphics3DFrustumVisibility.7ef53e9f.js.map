{"version":3,"file":"Graphics3DFrustumVisibility.7ef53e9f.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import{init as i}from\"../../../../core/watchUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{FrustumExtentIntersection as a}from\"../../support/FrustumExtentIntersection.js\";import{TaskPriority as l}from\"../../../support/Scheduler.js\";const h=1.2;let u=class extends t{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new s,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),r.registerTask(l.FRUSTUM_VISIBILITY,this),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([i(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),i(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([r({readOnly:!0})],u.prototype,\"suspended\",void 0),e([r({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);const c=u;export{c as default};\n"],"names":["t","s","a","l","i","o","r","n"],"mappings":"kHAI6sB,KAAM,GAAE,IAAI,GAAI,GAAE,aAAcA,EAAC,CAAC,aAAa,CAAC,MAAM,GAAG,WAAW,KAAK,UAAU,GAAG,KAAK,OAAO,KAAK,KAAK,wBAAwB,GAAG,KAAK,uBAAuB,GAAG,KAAK,QAAQ,GAAIC,GAAE,KAAK,UAAU,KAAK,KAAK,SAAS,GAAG,MAAM,EAAE,CAAC,KAAK,UAAU,EAAE,KAAK,mBAAmB,GAAIC,GAAE,CAAC,mBAAmB,EAAE,KAAK,qBAAqB,KAAM,GAAE,EAAE,KAAK,EAAE,EAAE,eAAe,EAAE,EAAE,mBAAmB,UAAU,KAAK,QAAQ,IAAI,CAAC,EAAE,GAAG,SAAU,IAAI,KAAK,cAAe,EAAE,MAAM,MAAM,SAAU,IAAI,KAAK,aAAc,IAAI,EAAE,aAAaC,EAAE,mBAAmB,MAAM,EAAE,GAAG,0BAA2B,IAAI,KAAK,2BAA4B,AAAU,EAAE,cAAZ,QAAwB,KAAK,sBAAsB,GAAG,KAAK,QAAQ,IAAI,CAACC,EAAE,EAAE,CAAC,UAAU,aAAc,IAAI,KAAK,+BAAgCA,EAAE,EAAE,uCAAwC,IAAI,KAAK,iCAAkC,SAAS,CAAC,KAAK,UAAU,KAAK,KAAK,OAAO,KAAK,KAAK,mBAAmB,KAAK,KAAK,SAAU,MAAK,QAAQ,UAAU,KAAK,QAAQ,MAAM,WAAW,CAAC,KAAK,UAAU,KAAK,KAAK,WAAW,IAAI,UAAU,EAAE,CAAC,KAAK,OAAO,EAAE,KAAK,wBAAwB,GAAG,KAAK,YAAY,YAAY,CAAC,KAAK,YAAY,uBAAuB,CAAC,KAAK,YAAY,KAAK,wBAAwB,MAAO,uBAAsB,EAAE,CAAC,KAAK,uBAAuB,EAAE,KAAK,YAAY,KAAK,wBAAwB,GAAG,6BAA6B,CAAC,KAAM,GAAE,KAAK,UAAU,KAAK,EAAE,EAAE,eAAe,EAAE,AAAU,EAAE,cAAZ,QAAwB,EAAE,EAAE,IAAI,QAAQ,EAAE,IAAI,OAAO,sBAAsB,AAAS,EAAE,IAAI,OAAO,qBAAqB,OAA3C,OAAgD,KAAK,sBAAsB,GAAG,CAAC,EAAE,QAAQ,EAAE,0BAA0B,CAAC,GAAG,CAAC,KAAK,wBAAwB,OAAO,KAAK,wBAAwB,GAAG,KAAM,GAAE,KAAK,UAAU,KAAK,GAAI,GAAE,GAAG,KAAK,uBAAuB,EAAE,IAAIC,EAAE,EAAE,kBAAkB,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE,eAAe,gBAAgB,EAAE,EAAE,KAAK,IAAI,EAAG,GAAE,GAAI,GAAE,IAAI,KAAK,mBAAmB,OAAO,KAAK,OAAO,EAAE,iBAAiB,MAAO,UAAS,CAAC,MAAO,MAAK,SAAS,SAAS,CAAC,GAAG,KAAK,KAAK,WAAW,IAAI,CAAC,KAAK,OAAO,MAAO,KAAK,MAAK,KAAK,YAAY,IAAI,KAAK,2BAA2B,KAAM,GAAE,KAAK,UAAU,KAAK,QAAQ,EAAEA,EAAE,KAAK,UAAU,KAAK,kBAAkB,OAAO,KAAK,KAAK,YAAY,CAAC,KAAK,mBAAmB,mBAAmB,EAAE,MAAM,EAAE,CAACC,EAAE,CAAC,SAAS,MAAM,EAAE,UAAU,YAAY,QAAQ,EAAE,CAACA,EAAE,CAAC,SAAS,MAAM,EAAE,UAAU,WAAW,QAAQ,EAAE,EAAE,CAACC,EAAE,8DAA8D,GAAQ,KAAC,GAAE"}
{"version":3,"file":"ImageryLayerView3D.831d05b4.js","sources":["../../node_modules/@arcgis/core/views/layers/ImageryLayerView.js","../../node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import p from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import a from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as n}from\"./support/popupUtils.js\";const u=u=>{let m=class extends u{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:s}=this;if(!e)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s});const{popupEnabled:i}=s,u=n(s,o);if(!i||!t(u))throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:u});const m=await u.getRequiredFields(),c=new a;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=m,c.outSpatialReference=e.spatialReference;const l=this.view.resolution,y=\"2d\"===this.view.type?new p(l,l,this.view.spatialReference):new p(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:w}=u.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},d={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:y,showNoDataRecords:w,signal:t(o)?o.signal:null};return s.queryVisibleRasters(c,d).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],m.prototype,\"layer\",void 0),e([o()],m.prototype,\"suspended\",void 0),e([o(i)],m.prototype,\"timeExtent\",void 0),e([o()],m.prototype,\"view\",void 0),m=e([s(\"esri.views.layers.ImageryLayerView\")],m),m};export{u as ImageryLayerView,u as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{isNone as t}from\"../../../core/maybe.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{whenOnce as i}from\"../../../core/watchUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/set.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{ImageryLayerView as o}from\"../../layers/ImageryLayerView.js\";let m=class extends(o(s)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=a((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([i(this.view.basemapTerrain,\"ready\",(()=>this.initializeMaximumDataResolution())),this.layer.on(\"redraw\",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,\"exportImageServiceParameters.version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,\"timeExtent\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement(\"canvas\"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||t(e.pixelData))return Promise.reject();const i=e.image,r=i.getContext(\"2d\"),s=await this.layer.applyRenderer(e.pixelData,{signal:a}),o=this.layer.applyFilter(s).pixelBlock;if(t(o))return Promise.reject();i.width=o.width,i.height=o.height;const m=r.createImageData(o.width,o.height);m.data.set(o.getAsRGBA()),r.putImageData(m,0,0)}};m=e([r(\"esri.views.3d.layers.ImageryLayerView3D\")],m);const n=m;export{n as default};\n"],"names":["s","r","n","t","a","p","o","i"],"mappings":"iWAIqnB,KAAM,GAAE,GAAG,CAAC,GAAI,GAAE,aAAc,EAAC,CAAC,aAAa,CAAC,MAAM,GAAG,WAAW,KAAK,KAAK,UAAW,oBAAmB,EAAE,EAAE,CAAC,KAAK,CAAC,MAAMA,GAAG,KAAK,GAAG,CAAC,EAAE,KAAM,IAAIC,GAAE,sCAAsC,gCAAgC,CAAC,MAAMD,IAAI,KAAK,CAAC,aAAa,GAAGA,EAAE,EAAEE,EAAEF,EAAE,GAAG,GAAG,CAAC,GAAG,CAACG,EAAE,GAAG,KAAM,IAAIF,GAAE,sCAAsC,iDAAiD,CAAC,aAAa,EAAE,cAAc,IAAI,KAAM,GAAE,KAAM,GAAE,oBAAoB,EAAE,GAAIG,GAAE,EAAE,WAAW,KAAK,WAAW,EAAE,SAAS,EAAE,EAAE,UAAU,EAAE,EAAE,oBAAoB,EAAE,iBAAiB,KAAM,GAAE,KAAK,KAAK,WAAW,EAAE,AAAO,KAAK,KAAK,OAAjB,KAAsB,GAAIC,GAAE,EAAE,EAAE,KAAK,KAAK,kBAAkB,GAAIA,GAAE,GAAG,EAAE,GAAG,EAAE,KAAK,KAAK,kBAAkB,CAAC,oBAAoB,EAAE,kBAAkB,GAAG,EAAE,cAAc,CAAC,oBAAoB,GAAG,kBAAkB,IAAI,EAAE,CAAC,mBAAmB,GAAG,oBAAoB,EAAE,UAAU,EAAE,kBAAkB,EAAE,OAAOF,EAAE,GAAG,EAAE,OAAO,MAAM,MAAOH,GAAE,oBAAoB,EAAE,GAAG,KAAM,GAAG,GAAI,WAAW,CAAC,GAAI,GAAE,MAAM,CAAC,CAAC,MAAM,aAAc,CAAO,GAAE,KAAK,aAAd,MAA2B,CAAC,EAAE,WAAW,MAAO,GAAE,CAACM,KAAK,EAAE,UAAU,QAAQ,QAAQ,EAAE,CAACA,KAAK,EAAE,UAAU,YAAY,QAAQ,EAAE,CAACA,EAAEC,IAAI,EAAE,UAAU,aAAa,QAAQ,EAAE,CAACD,KAAK,EAAE,UAAU,OAAO,QAAQ,EAAE,EAAE,CAACN,EAAE,uCAAuC,GAAG,GCAjwC,GAAI,GAAE,aAAcM,GAAEN,EAAG,CAAC,aAAa,CAAC,MAAM,GAAG,WAAW,KAAK,KAAK,aAAa,KAAK,gBAAgBI,EAAG,KAAM,IAAG,CAAC,KAAK,OAAQ,CAAC,EAAE,IAAI,KAAK,aAAa,EAAE,GAAI,IAAK,KAAK,YAAY,CAAC,KAAK,QAAQ,IAAI,CAACG,EAAE,KAAK,KAAK,eAAe,QAAS,IAAI,KAAK,mCAAoC,KAAK,MAAM,GAAG,SAAU,IAAI,KAAK,qBAAsB,KAAK,gBAAgB,IAAI,KAAK,MAAM,uCAAwC,IAAI,CAAC,KAAK,gBAAgB,WAAW,KAAK,sBAAuB,KAAK,gBAAgB,IAAI,KAAK,aAAc,IAAI,KAAK,gBAAgB,WAAW,KAAK,qBAAsB,iCAAiC,CAAC,KAAM,GAAE,KAAK,KAAK,eAAe,iBAAiB,EAAE,KAAK,MAAM,WAAW,GAAG,EAAE,OAAO,EAAE,mBAAoB,MAAK,sBAAsB,CAAC,EAAE,KAAK,MAAM,WAAW,EAAE,KAAK,MAAM,aAAa,iBAAiB,CAAC,MAAM,CAAC,WAAW,KAAK,iBAAkB,eAAc,EAAE,EAAE,EAAE,CAAC,EAAE,aAAa,EAAE,MAAM,EAAE,aAAc,GAAE,MAAM,SAAS,cAAc,UAAU,EAAE,UAAU,EAAE,UAAU,KAAM,MAAK,aAAa,EAAE,SAAU,cAAa,EAAE,EAAE,CAAC,GAAG,CAAE,GAAE,gBAAiB,qBAAoB,EAAE,EAAE,WAAW,MAAO,SAAQ,SAAS,KAAM,GAAE,EAAE,MAAM,EAAE,EAAE,WAAW,MAAM,EAAE,KAAM,MAAK,MAAM,cAAc,EAAE,UAAU,CAAC,OAAO,IAAI,EAAE,KAAK,MAAM,YAAY,GAAG,WAAW,GAAG,EAAE,GAAG,MAAO,SAAQ,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,KAAM,GAAE,EAAE,gBAAgB,EAAE,MAAM,EAAE,QAAQ,EAAE,KAAK,IAAI,EAAE,aAAa,EAAE,aAAa,EAAE,EAAE,KAAK,EAAE,EAAE,CAACN,EAAE,4CAA4C,GAAQ,KAAC,GAAE"}
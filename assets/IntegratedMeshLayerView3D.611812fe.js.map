{"version":3,"file":"IntegratedMeshLayerView3D.611812fe.js","sources":["../../node_modules/@arcgis/core/views/3d/layers/IntegratedMeshLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Graphic.js\";import{isSome as r,isNone as o}from\"../../../core/maybe.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import{f as s,c as l}from\"../../../chunks/vec4f64.js\";import{area as n,width as h,height as c}from\"../../../geometry/support/aaBoundingRect.js\";import{I3SMeshView3D as d}from\"./I3SMeshView3D.js\";import{LayerView3D as p}from\"./LayerView3D.js\";import{updatingProgress as y}from\"../support/updatingProperties.js\";import u from\"../../layers/LayerView.js\";const g=.2;let v=class extends(d(p(u))){constructor(){super(...arguments),this.type=\"integrated-mesh-3d\",this.lodFactor=1,this._elevationContext=\"im\",this._isIntegratedMesh=!0,this._supportsLabeling=!1,this.drapeTargetType=1,this._overlayTexOffset=s(-1,-1,-1,-1),this._overlayTexScale=l(),this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}get progressiveLoadFactor(){return this.lodFactor>=1?g:1}setDrapingTextures(e){this._clearDrapingTexture(0),this._clearDrapingTexture(1);for(const t of e){const e=t.index,o=t.extent,a=t.needsColorWithoutRasterImage?t.getValidTarget(1):t.hasDrapedFeatureSource?t.getValidTarget(0):null;if(r(a)&&n(o)>0){this._overlayTexOffset[2*e]=-o[0]/h(o),this._overlayTexOffset[2*e+1]=-o[1]/c(o),this._overlayTexScale[2*e]=1/h(o),this._overlayTexScale[2*e+1]=1/c(o);const r=t.getValidTarget(2),i=t.getValidTarget(3);this._overlayColor=a.getTexture(),this._overlayHighlight=r?r.getTexture():null,this._overlayNormal=i?i.getTexture():null}}this._forAllNodes((e=>r(e)&&this._collection.updateMaterial(e.objectHandle,(e=>this._updateMaterialOverlay(e)))))}_clearDrapingTexture(e){this._overlayTexOffset[2*e]=-1,this._overlayTexOffset[2*e+1]=-1,this._overlayTexScale[2*e]=0,this._overlayTexScale[2*e+1]=0,this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}_updateMaterialOverlay(e){e.overlayColor=this._overlayColor,e.overlayHighlight=this._overlayHighlight,e.overlayNormal=this._overlayNormal,e.overlayTexOffset=this._overlayTexOffset,e.overlayTexScale=this._overlayTexScale}initialize(){this.updatingHandles.add(this.layer,\"modifications\",(()=>this._loadModifications()),2)}_createLayerGraphic(){const e=new t;return e.layer=this.layer,e.sourceLayer=this.layer,e}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}_loadModifications(){if(this.handles.remove(\"modifications\"),o(this.layer.modifications))return void(this._modifications=[]);const e=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(e,(()=>this._modifications=e.toArray()),2),\"modifications\")}};e([a()],v.prototype,\"layer\",void 0),e([a({aliasOf:\"layer\"})],v.prototype,\"i3slayer\",void 0),e([a()],v.prototype,\"suspended\",void 0),e([a(y)],v.prototype,\"updatingProgress\",void 0),e([a({readOnly:!0,aliasOf:\"_controller.updatingProgress\"})],v.prototype,\"updatingProgressValue\",void 0),e([a({readOnly:!0,aliasOf:\"view.qualitySettings.sceneService.integratedMesh.lodFactor\"})],v.prototype,\"lodFactor\",void 0),e([a({readOnly:!0})],v.prototype,\"progressiveLoadFactor\",null),v=e([i(\"esri.views.3d.layers.SceneLayerView3D\")],v);const f=v;export{f as default};\n"],"names":["d","s","l","r","n","h","c","t","o","a","y"],"mappings":"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"}
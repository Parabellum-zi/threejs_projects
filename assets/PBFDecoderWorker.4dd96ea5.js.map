{"version":3,"file":"PBFDecoderWorker.4dd96ea5.js","sources":["../../node_modules/@arcgis/core/rest/query/operations/pbfDehydratedFeatureSet.js","../../node_modules/@arcgis/core/views/3d/support/PBFDecoderWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{neverReached as t}from\"../../../core/compilerUtils.js\";import{isNone as e}from\"../../../core/maybe.js\";import{generateUID as r}from\"../../../core/uid.js\";import o from\"../../../geometry/SpatialReference.js\";import{getGeometryZScaler as s}from\"../../../geometry/support/zscale.js\";import{DehydratedFeatureSetClass as i,DehydratedFeatureClass as n}from\"../../../layers/graphics/dehydratedFeatures.js\";import{unquantizeOptimizedGeometry as a,convertToGeometry as h}from\"../../../layers/graphics/featureConversionUtils.js\";import l from\"../../../layers/support/Field.js\";function u(t,e){return e}function p(t,e,r,o){switch(r){case 0:return m(t,e+o,0);case 1:return\"lowerLeft\"===t.originPosition?m(t,e+o,1):y(t,e+o,1)}}function c(t,e,r,o){return 2===r?m(t,e,2):p(t,e,r,o)}function d(t,e,r,o){return 2===r?m(t,e,3):p(t,e,r,o)}function f(t,e,r,o){return 3===r?m(t,e,3):c(t,e,r,o)}function m({translate:t,scale:e},r,o){return t[o]+r*e[o]}function y({translate:t,scale:e},r,o){return t[o]-r*e[o]}class g{constructor(t){this.options=t,this.geometryTypes=[\"point\",\"multipoint\",\"polyline\",\"polygon\"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}createFeatureResult(){return new i}finishFeatureResult(t){if(this.options.applyTransform&&(t.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!t.hasZ)return;const r=s(t.geometryType,this.options.sourceSpatialReference,t.spatialReference);if(!e(r))for(const e of t.features)r(e.geometry)}createSpatialReference(){return new o}addField(t,e){t.fields.push(l.fromJSON(e));const r=t.fields.map((t=>t.name));this.AttributesConstructor=function(){for(const t of r)this[t]=null}}addFeature(t,e){const r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(const o in e.attributes){const t=e.attributes[o];\"string\"==typeof t&&t.length>r&&(e.attributes[o]=\"\")}t.features.push(e)}addQueryGeometry(t,e){const{queryGeometry:r,queryGeometryType:o}=e,s=a(r.clone(),r,!1,!1,this.transform),i=h(s,o,!1,!1);let n=null;switch(o){case\"esriGeometryPoint\":n=\"point\";break;case\"esriGeometryPolygon\":n=\"polygon\";break;case\"esriGeometryPolyline\":n=\"polyline\";break;case\"esriGeometryMultipoint\":n=\"multipoint\"}i.type=n,t.queryGeometryType=o,t.queryGeometry=i}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case\"point\":this.addCoordinate=(t,e,r)=>this.addCoordinatePoint(t,e,r),this.createGeometry=t=>this.createPointGeometry(t);break;case\"polygon\":this.addCoordinate=(t,e,r)=>this.addCoordinatePolygon(t,e,r),this.createGeometry=t=>this.createPolygonGeometry(t);break;case\"polyline\":this.addCoordinate=(t,e,r)=>this.addCoordinatePolyline(t,e,r),this.createGeometry=t=>this.createPolylineGeometry(t);break;case\"multipoint\":this.addCoordinate=(t,e,r)=>this.addCoordinateMultipoint(t,e,r),this.createGeometry=t=>this.createMultipointGeometry(t);break;case\"mesh\":case\"extent\":break;default:t(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,new n(r(),null,new this.AttributesConstructor)}allocateCoordinates(){const t=this.lengths.reduce(((t,e)=>t+e),0);this.coordinateBuffer=new Float64Array(t*this.vertexDimension),this.coordinateBufferPtr=0}addLength(t,e,r){0===this.lengths.length&&(this.toAddInCurrentPath=e),this.lengths.push(e)}createPointGeometry(t){const e={type:\"point\",x:0,y:0,spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM};return e.hasZ&&(e.z=0),e.hasM&&(e.m=0),e}addCoordinatePoint(t,e,r){switch(e=this.applyTransform(this.transform,e,r,0),r){case 0:t.x=e;break;case 1:t.y=e;break;case 2:t.hasZ?t.z=e:t.m=e;break;case 3:t.m=e}}transformPathLikeValue(t,e){let r=0;return e<=1&&(r=this.previousCoordinate[e],this.previousCoordinate[e]+=t),this.applyTransform(this.transform,t,e,r)}addCoordinatePolyline(t,e,r){this.dehydratedAddPointsCoordinate(t.paths,e,r)}addCoordinatePolygon(t,e,r){this.dehydratedAddPointsCoordinate(t.rings,e,r)}addCoordinateMultipoint(t,e,r){0===r&&t.points.push([]);const o=this.transformPathLikeValue(e,r);t.points[t.points.length-1].push(o)}createPolygonGeometry(t){return{type:\"polygon\",rings:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}createPolylineGeometry(t){return{type:\"polyline\",paths:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}createMultipointGeometry(t){return{type:\"multipoint\",points:[],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}dehydratedAddPointsCoordinate(t,e,r){0===r&&0==this.toAddInCurrentPath--&&(t.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const o=this.transformPathLikeValue(e,r),s=t[t.length-1];0===r&&s.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=o}deriveApplyTransform(t){const{hasZ:e,hasM:r}=t;return e&&r?f:e?c:r?d:p}}export{g as DehydratedFeatureSetParserContext};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{DehydratedFeatureSetParserContext as e}from\"../../../rest/query/operations/pbfDehydratedFeatureSet.js\";import{parsePBFFeatureQuery as r}from\"../../../rest/query/operations/pbfQueryUtils.js\";class t{_parseFeatureQuery(t){const s=r(t.buffer,new e(t.options)),o={...s,spatialReference:s.spatialReference.toJSON(),fields:s.fields?s.fields.map((e=>e.toJSON())):void 0};return Promise.resolve(o)}}function s(){return new t}export{s as default};\n"],"names":["i","s","e","o","l","a","h","t","n","r"],"mappings":"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"}
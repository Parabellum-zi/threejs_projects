{"version":3,"file":"arcgisLayers.0fd202e0.js","sources":["../../node_modules/@arcgis/core/layers/support/arcgisLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import r from\"../../core/Error.js\";import{isNone as a,isSome as t}from\"../../core/maybe.js\";import{getFilename as l,urlToObject as n}from\"../../core/urlUtils.js\";import{parse as s,parseNonStandardSublayerUrl as o}from\"./arcgisLayerUrl.js\";import{layerLookupMap as u}from\"./lazyLayerLoader.js\";async function i(e){var r;const a=null==(r=e.properties)?void 0:r.customParameters,t=await d(e.url,a),l={...e.properties,url:e.url};if(!t.sublayerIds)return null!=t.layerOrTableId&&(l.layerId=t.layerOrTableId,l.sourceJSON=t.sourceJSON),new t.Constructor(l);const n=new(0,(await import(\"../GroupLayer.js\")).default)({title:t.parsedUrl.title});return c(n,t,l),n}function y(e,r){return e?e.find((e=>e.id===r)):null}function c(e,r,a){function l(e,l){const n={...a,layerId:e,sublayerTitleMode:\"service-name\"};return t(l)&&(n.sourceJSON=l),new r.Constructor(n)}r.sublayerIds.forEach((a=>{const t=l(a,y(r.sublayerInfos,a));e.add(t)})),r.tableIds.forEach((a=>{const t=l(a,y(r.tableInfos,a));e.tables.add(t)}))}async function d(e,t){let l=s(e);if(a(l)&&(l=await f(e,t)),a(l))throw new r(\"arcgis-layers:url-mismatch\",\"The url '${url}' is not a valid arcgis resource\",{url:e});const{serverType:n,sublayer:o}=l;let u;const i={FeatureServer:\"FeatureLayer\",StreamServer:\"StreamLayer\",VectorTileServer:\"VectorTileLayer\"};switch(n){case\"MapServer\":u=null!=o?\"FeatureLayer\":S(e,t).then((e=>e?\"TileLayer\":\"MapImageLayer\"));break;case\"ImageServer\":u=w(e,t).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?!r||\"LERC\"!==r.toUpperCase()||e.cacheType&&\"elevation\"!==e.cacheType.toLowerCase()?\"ImageryTileLayer\":\"ElevationLayer\":\"ImageryLayer\"}));break;case\"SceneServer\":u=w(l.url.path,t).then((e=>{if(e){if(\"Voxel\"===(null==e?void 0:e.layerType))return\"VoxelLayer\";if(null!=e&&e.layers&&Array.isArray(e.layers)&&e.layers.length>0){var r;const a={Point:\"SceneLayer\",\"3DObject\":\"SceneLayer\",IntegratedMesh:\"IntegratedMeshLayer\",PointCloud:\"PointCloudLayer\",Building:\"BuildingSceneLayer\"},t=null==(r=e.layers[0])?void 0:r.layerType;if(null!=a[t])return a[t]}}return\"SceneLayer\"}));break;default:u=i[n]}const y={FeatureLayer:!0,SceneLayer:!0},c=\"FeatureServer\"===n,d={parsedUrl:l,Constructor:null,layerOrTableId:c?o:null,sublayerIds:null,tableIds:null},p=await u;if(y[p]&&null==o){const r=await v(e,n,t);c&&(d.sublayerInfos=r.layerInfos,d.tableInfos=r.tableInfos);if(1!==r.layerIds.length+r.tableIds.length)d.sublayerIds=r.layerIds,d.tableIds=r.tableIds;else if(c){var I,b;d.layerOrTableId=null!=(I=r.layerIds[0])?I:r.tableIds[0],d.sourceJSON=null!=(b=r.layerInfos[0])?b:r.tableInfos[0]}}return d.Constructor=await m(p),d}async function f(e,r){var a;const s=await w(e,r);let u=null,i=null;const y=s.type;if(\"Feature Layer\"===y||\"Table\"===y?(u=\"FeatureServer\",i=s.id):\"indexedVector\"===y?u=\"VectorTileServer\":s.hasOwnProperty(\"mapName\")?u=\"MapServer\":s.hasOwnProperty(\"bandCount\")&&s.hasOwnProperty(\"pixelSizeX\")?u=\"ImageServer\":s.hasOwnProperty(\"maxRecordCount\")&&s.hasOwnProperty(\"allowGeometryUpdates\")?u=\"FeatureServer\":s.hasOwnProperty(\"streamUrls\")?u=\"StreamServer\":p(s)?(u=\"SceneServer\",i=s.id):s.hasOwnProperty(\"layers\")&&p(null==(a=s.layers)?void 0:a[0])&&(u=\"SceneServer\"),!u)return null;const c=null!=i?o(e):null;return{title:t(c)&&s.name||l(e),serverType:u,sublayer:i,url:{path:t(c)?c.serviceUrl:n(e).path}}}function p(e){return(null==e?void 0:e.hasOwnProperty(\"store\"))&&e.hasOwnProperty(\"id\")&&\"number\"==typeof e.id}async function v(e,r,a){var t,l;let n,s=!1;if(\"FeatureServer\"===r){const r=await b(e,a);s=!!r.layersJSON,n=r.layersJSON||r.serviceJSON}else n=await w(e,a);const o=null==(t=n)?void 0:t.layers,u=null==(l=n)?void 0:l.tables;return{layerIds:(null==o?void 0:o.map((e=>e.id)).reverse())||[],tableIds:(null==u?void 0:u.map((e=>e.id)).reverse())||[],layerInfos:s?o:[],tableInfos:s?u:[]}}function I(e){return!e.type||\"Feature Layer\"===e.type}async function b(e,r){var a,t;let l=await w(e,r);l=l||{},l.layers=(null==(a=l.layers)?void 0:a.filter(I))||[];const n={serviceJSON:l};if(l.currentVersion<10.5)return n;const s=await w(e+\"/layers\",r);return n.layersJSON={layers:(null==s||null==(t=s.layers)?void 0:t.filter(I))||[],tables:(null==s?void 0:s.tables)||[]},n}async function m(e){return(0,u[e])()}async function S(e,r){return(await w(e,r)).tileInfo}async function w(r,a){return(await e(r,{responseType:\"json\",query:{f:\"json\",...a}})).data}export{i as fromUrl};\n"],"names":["r","t","s","a","o","l","n","u","e"],"mappings":"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"}
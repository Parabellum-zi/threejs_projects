{"version":3,"file":"RasterWorker.2c284f8a.js","sources":["../../node_modules/@arcgis/core/layers/support/RasterWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as r}from\"../../core/maybe.js\";import e from\"../../geometry/support/GeographicTransformation.js\";import t from\"./PixelBlock.js\";import{decode as o}from\"./rasterFormats/RasterCodec.js\";import{estimateStatisticsHistograms as s,split as i,mosaic as a,approximateTransform as n}from\"./rasterFunctions/pixelUtils.js\";import{requirePE as m,load as l,getProjectionOffsetGrid as f}from\"./rasterFunctions/rasterProjectionHelper.js\";import{convertVectorFieldData as c}from\"./rasterFunctions/vectorFieldUtils.js\";import{readTransform as p}from\"./rasterTransforms/utils.js\";import u from\"../../renderers/support/RasterSymbolizer.js\";import{createStreamlinesMesh as d}from\"../../views/2d/engine/flow/dataUtils.js\";import S from\"../../geometry/Extent.js\";class h{convertVectorFieldData(e){const o=t.fromJSON(e.pixelBlock),s=c(o,e.type);return Promise.resolve(r(s)&&s.toJSON())}async decode(r){const e=await o(r.data,r.options);return e&&e.toJSON()}symbolize(e){e.pixelBlock=t.fromJSON(e.pixelBlock),e.extent=e.extent?S.fromJSON(e.extent):null;const o=this.symbolizer.symbolize(e);return Promise.resolve(r(o)&&o.toJSON())}async updateSymbolizer(r){var e;this.symbolizer=u.fromJSON(r.symbolizerJSON),r.histograms&&\"rasterStretch\"===(null==(e=this.symbolizer)?void 0:e.rendererJSON.type)&&(this.symbolizer.rendererJSON.histograms=r.histograms)}stretch(e){const o=this.symbolizer.simpleStretch(t.fromJSON(e.srcPixelBlock),e.stretchParams);return Promise.resolve(r(o)&&o.toJSON())}estimateStatisticsHistograms(r){const e=s(t.fromJSON(r.srcPixelBlock));return Promise.resolve(e)}split(r){const e=i(t.fromJSON(r.srcPixelBlock),r.tileSize,r.maximumPyramidLevel);return e&&e.forEach(((r,t)=>{e.set(t,null==r?void 0:r.toJSON())})),Promise.resolve(e)}async mosaicAndTransform(r){const e=r.srcPixelBlocks.map((r=>r?new t(r):null)),o=a(e,r.srcMosaicSize,{blockWidths:r.blockWidths,alignmentInfo:r.alignmentInfo});if(!r.coefs)return o&&o.toJSON();const s=n(o,r.destDimension,r.coefs,r.sampleSpacing,r.interpolation);return s&&s.toJSON()}async createStreamlinesMesh(r,e){const t={data:new Float32Array(r.flowData.buffer),width:r.flowData.width,height:r.flowData.height},{vertexData:o,indexData:s}=await d(r.rendererSettings,t,e.signal);return{result:{vertexBuffer:o.buffer,indexBuffer:s.buffer},transferList:[o.buffer,s.buffer]}}async getProjectionOffsetGrid(r){const t=S.fromJSON(r.projectedExtent),o=S.fromJSON(r.srcBufferExtent);let s=null;r.datumTransformationStemps&&(s=new e({steps:r.datumTransformationStemps})),m(t.spatialReference,o.spatialReference,s)&&await l();const i=r.rasterTransform?p(r.rasterTransform):null;return f({...r,projectedExtent:t,srcBufferExtent:o,datumTransformation:s,rasterTransform:i})}}export{h as default};\n"],"names":["t","c","o","S","u","i","a","n","d","e","m","l","p","f"],"mappings":"syBAI6wB,OAAO,CAAC,uBAAuB,EAAE,CAAC,KAAM,GAAEA,EAAE,SAAS,EAAE,YAAY,EAAEC,EAAE,EAAE,EAAE,MAAM,MAAO,SAAQ,QAAQ,EAAE,IAAI,EAAE,eAAgB,QAAO,EAAE,CAAC,KAAM,GAAE,KAAMC,GAAE,EAAE,KAAK,EAAE,SAAS,MAAO,IAAG,EAAE,SAAS,UAAU,EAAE,CAAC,EAAE,WAAWF,EAAE,SAAS,EAAE,YAAY,EAAE,OAAO,EAAE,OAAOG,EAAE,SAAS,EAAE,QAAQ,KAAK,KAAM,GAAE,KAAK,WAAW,UAAU,GAAG,MAAO,SAAQ,QAAQ,EAAE,IAAI,EAAE,eAAgB,kBAAiB,EAAE,CAAC,GAAI,GAAE,KAAK,WAAWC,EAAE,SAAS,EAAE,gBAAgB,EAAE,YAAY,AAAmB,CAAO,GAAE,KAAK,aAAd,KAA0B,OAAO,EAAE,aAAa,QAAnE,iBAA2E,MAAK,WAAW,aAAa,WAAW,EAAE,YAAY,QAAQ,EAAE,CAAC,KAAM,GAAE,KAAK,WAAW,cAAcJ,EAAE,SAAS,EAAE,eAAe,EAAE,eAAe,MAAO,SAAQ,QAAQ,EAAE,IAAI,EAAE,UAAU,6BAA6B,EAAE,CAAC,KAAM,GAAE,EAAEA,EAAE,SAAS,EAAE,gBAAgB,MAAO,SAAQ,QAAQ,GAAG,MAAM,EAAE,CAAC,KAAM,GAAEK,EAAEL,EAAE,SAAS,EAAE,eAAe,EAAE,SAAS,EAAE,qBAAqB,MAAO,IAAG,EAAE,QAAS,CAAC,EAAE,IAAI,CAAC,EAAE,IAAI,EAAE,AAAM,GAAN,KAAQ,OAAO,EAAE,YAAa,QAAQ,QAAQ,QAAS,oBAAmB,EAAE,CAAC,KAAM,GAAE,EAAE,eAAe,IAAK,GAAG,EAAE,GAAIA,GAAE,GAAG,MAAO,EAAEM,EAAE,EAAE,EAAE,cAAc,CAAC,YAAY,EAAE,YAAY,cAAc,EAAE,gBAAgB,GAAG,CAAC,EAAE,MAAM,MAAO,IAAG,EAAE,SAAS,KAAM,GAAEC,EAAE,EAAE,EAAE,cAAc,EAAE,MAAM,EAAE,cAAc,EAAE,eAAe,MAAO,IAAG,EAAE,cAAe,uBAAsB,EAAE,EAAE,CAAC,KAAM,GAAE,CAAC,KAAK,GAAI,cAAa,EAAE,SAAS,QAAQ,MAAM,EAAE,SAAS,MAAM,OAAO,EAAE,SAAS,QAAQ,CAAC,WAAW,EAAE,UAAU,GAAG,KAAMC,GAAE,EAAE,iBAAiB,EAAE,EAAE,QAAQ,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,OAAO,YAAY,EAAE,QAAQ,aAAa,CAAC,EAAE,OAAO,EAAE,cAAe,yBAAwB,EAAE,CAAC,KAAM,GAAEL,EAAE,SAAS,EAAE,iBAAiB,EAAEA,EAAE,SAAS,EAAE,iBAAiB,GAAI,GAAE,KAAK,EAAE,2BAA4B,GAAE,GAAIM,GAAE,CAAC,MAAM,EAAE,6BAA6BC,EAAE,EAAE,iBAAiB,EAAE,iBAAiB,IAAI,KAAMC,KAAI,KAAM,GAAE,EAAE,gBAAgBC,EAAE,EAAE,iBAAiB,KAAK,MAAOC,GAAE,OAAI,GAAJ,CAAM,gBAAgB,EAAE,gBAAgB,EAAE,oBAAoB,EAAE,gBAAgB"}
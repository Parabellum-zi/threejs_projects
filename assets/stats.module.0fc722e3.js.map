{"version":3,"file":"stats.module.0fc722e3.js","sources":["../../src/utils/ResourceTracker.js","../../node_modules/three/examples/jsm/libs/stats.module.js"],"sourcesContent":["/**\n * 以下销毁方法参考自 https://threejs.org/manual/#en/cleanup\n * @Description: three js  dispose\n * 将所有需要add to scene的如 mesh、geometry、texture、object3D、外部加载的obj模型、gltf模型等等，全部调用一下track方法\n * @author parabellum\n * @date 2022/3/2\n */\nimport * as THREE from \"three\";\nexport default class ResourceTracker {\n  constructor() {\n    this.resources = new Set();\n  }\n  track(resource) {\n    if (!resource) {\n      return resource;\n    }\n\n    // handle children and when material is an array of materials or\n    // uniform is array of textures\n    if (Array.isArray(resource)) {\n      resource.forEach((resource) => this.track(resource));\n      return resource;\n    }\n\n    if (resource.dispose || resource instanceof THREE.Object3D) {\n      this.resources.add(resource);\n    }\n    if (resource instanceof THREE.Object3D) {\n      this.track(resource.geometry);\n      this.track(resource.material);\n      this.track(resource.children);\n    } else if (resource instanceof THREE.Material) {\n      // We have to check if there are any textures on the material\n      for (const value of Object.values(resource)) {\n        if (value instanceof THREE.Texture) {\n          this.track(value);\n        }\n      }\n      // We also have to check if any uniforms reference textures or arrays of textures\n      if (resource.uniforms) {\n        for (const value of Object.values(resource.uniforms)) {\n          if (value) {\n            const uniformValue = value.value;\n            if (\n              uniformValue instanceof THREE.Texture ||\n              Array.isArray(uniformValue)\n            ) {\n              this.track(uniformValue);\n            }\n          }\n        }\n      }\n    }\n    return resource;\n  }\n  untrack(resource) {\n    this.resources.delete(resource);\n  }\n  dispose() {\n    for (const resource of this.resources) {\n      if (resource instanceof THREE.Object3D) {\n        if (resource.parent) {\n          resource.parent.remove(resource);\n        }\n      }\n      if (resource.dispose) {\n        resource.dispose();\n      }\n    }\n    this.resources.clear();\n  }\n}\n","var Stats = function () {\n\n\tvar mode = 0;\n\n\tvar container = document.createElement( 'div' );\n\tcontainer.style.cssText = 'position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000';\n\tcontainer.addEventListener( 'click', function ( event ) {\n\n\t\tevent.preventDefault();\n\t\tshowPanel( ++ mode % container.children.length );\n\n\t}, false );\n\n\t//\n\n\tfunction addPanel( panel ) {\n\n\t\tcontainer.appendChild( panel.dom );\n\t\treturn panel;\n\n\t}\n\n\tfunction showPanel( id ) {\n\n\t\tfor ( var i = 0; i < container.children.length; i ++ ) {\n\n\t\t\tcontainer.children[ i ].style.display = i === id ? 'block' : 'none';\n\n\t\t}\n\n\t\tmode = id;\n\n\t}\n\n\t//\n\n\tvar beginTime = ( performance || Date ).now(), prevTime = beginTime, frames = 0;\n\n\tvar fpsPanel = addPanel( new Stats.Panel( 'FPS', '#0ff', '#002' ) );\n\tvar msPanel = addPanel( new Stats.Panel( 'MS', '#0f0', '#020' ) );\n\n\tif ( self.performance && self.performance.memory ) {\n\n\t\tvar memPanel = addPanel( new Stats.Panel( 'MB', '#f08', '#201' ) );\n\n\t}\n\n\tshowPanel( 0 );\n\n\treturn {\n\n\t\tREVISION: 16,\n\n\t\tdom: container,\n\n\t\taddPanel: addPanel,\n\t\tshowPanel: showPanel,\n\n\t\tbegin: function () {\n\n\t\t\tbeginTime = ( performance || Date ).now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tframes ++;\n\n\t\t\tvar time = ( performance || Date ).now();\n\n\t\t\tmsPanel.update( time - beginTime, 200 );\n\n\t\t\tif ( time >= prevTime + 1000 ) {\n\n\t\t\t\tfpsPanel.update( ( frames * 1000 ) / ( time - prevTime ), 100 );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t\tif ( memPanel ) {\n\n\t\t\t\t\tvar memory = performance.memory;\n\t\t\t\t\tmemPanel.update( memory.usedJSHeapSize / 1048576, memory.jsHeapSizeLimit / 1048576 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tbeginTime = this.end();\n\n\t\t},\n\n\t\t// Backwards Compatibility\n\n\t\tdomElement: container,\n\t\tsetMode: showPanel\n\n\t};\n\n};\n\nStats.Panel = function ( name, fg, bg ) {\n\n\tvar min = Infinity, max = 0, round = Math.round;\n\tvar PR = round( window.devicePixelRatio || 1 );\n\n\tvar WIDTH = 80 * PR, HEIGHT = 48 * PR,\n\t\tTEXT_X = 3 * PR, TEXT_Y = 2 * PR,\n\t\tGRAPH_X = 3 * PR, GRAPH_Y = 15 * PR,\n\t\tGRAPH_WIDTH = 74 * PR, GRAPH_HEIGHT = 30 * PR;\n\n\tvar canvas = document.createElement( 'canvas' );\n\tcanvas.width = WIDTH;\n\tcanvas.height = HEIGHT;\n\tcanvas.style.cssText = 'width:80px;height:48px';\n\n\tvar context = canvas.getContext( '2d' );\n\tcontext.font = 'bold ' + ( 9 * PR ) + 'px Helvetica,Arial,sans-serif';\n\tcontext.textBaseline = 'top';\n\n\tcontext.fillStyle = bg;\n\tcontext.fillRect( 0, 0, WIDTH, HEIGHT );\n\n\tcontext.fillStyle = fg;\n\tcontext.fillText( name, TEXT_X, TEXT_Y );\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\n\n\tcontext.fillStyle = bg;\n\tcontext.globalAlpha = 0.9;\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\n\n\treturn {\n\n\t\tdom: canvas,\n\n\t\tupdate: function ( value, maxValue ) {\n\n\t\t\tmin = Math.min( min, value );\n\t\t\tmax = Math.max( max, value );\n\n\t\t\tcontext.fillStyle = bg;\n\t\t\tcontext.globalAlpha = 1;\n\t\t\tcontext.fillRect( 0, 0, WIDTH, GRAPH_Y );\n\t\t\tcontext.fillStyle = fg;\n\t\t\tcontext.fillText( round( value ) + ' ' + name + ' (' + round( min ) + '-' + round( max ) + ')', TEXT_X, TEXT_Y );\n\n\t\t\tcontext.drawImage( canvas, GRAPH_X + PR, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT, GRAPH_X, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT );\n\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, GRAPH_HEIGHT );\n\n\t\t\tcontext.fillStyle = bg;\n\t\t\tcontext.globalAlpha = 0.9;\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, round( ( 1 - ( value / maxValue ) ) * GRAPH_HEIGHT ) );\n\n\t\t}\n\n\t};\n\n};\n\nexport default Stats;\n"],"names":["THREE.Object3D","THREE.Material","THREE.Texture"],"mappings":"wDAQe,OAAsB,CACnC,aAAc,CACZ,KAAK,UAAY,GAAI,KAEvB,MAAM,EAAU,CACd,GAAI,CAAC,EACH,MAAO,GAKT,GAAI,MAAM,QAAQ,GAChB,SAAS,QAAQ,AAAC,GAAa,KAAK,MAAM,IACnC,EAMT,GAHI,GAAS,SAAW,YAAoBA,KAC1C,KAAK,UAAU,IAAI,GAEjB,YAAoBA,GACtB,KAAK,MAAM,EAAS,UACpB,KAAK,MAAM,EAAS,UACpB,KAAK,MAAM,EAAS,kBACX,YAAoBC,GAAgB,CAE7C,SAAW,KAAS,QAAO,OAAO,GAChC,AAAI,YAAiBC,IACnB,KAAK,MAAM,GAIf,GAAI,EAAS,UACX,SAAW,KAAS,QAAO,OAAO,EAAS,UACzC,GAAI,EAAO,CACT,KAAM,GAAe,EAAM,MAC3B,AACE,aAAwBA,IACxB,MAAM,QAAQ,KAEd,KAAK,MAAM,KAMrB,MAAO,GAET,QAAQ,EAAU,CAChB,KAAK,UAAU,OAAO,GAExB,SAAU,CACR,SAAW,KAAY,MAAK,UAC1B,AAAI,YAAoBF,IAClB,EAAS,QACX,EAAS,OAAO,OAAO,GAGvB,EAAS,SACX,EAAS,UAGb,KAAK,UAAU,SCrEnB,GAAI,GAAQ,UAAY,CAEvB,GAAI,GAAO,EAEP,EAAY,SAAS,cAAe,OACxC,EAAU,MAAM,QAAU,uEAC1B,EAAU,iBAAkB,QAAS,SAAW,EAAQ,CAEvD,EAAM,iBACN,EAAW,EAAG,EAAO,EAAU,SAAS,SAEtC,IAIH,WAAmB,EAAQ,CAE1B,SAAU,YAAa,EAAM,KACtB,EAIR,WAAoB,EAAK,CAExB,OAAU,GAAI,EAAG,EAAI,EAAU,SAAS,OAAQ,IAE/C,EAAU,SAAU,GAAI,MAAM,QAAU,IAAM,EAAK,QAAU,OAI9D,EAAO,EAMR,GAAI,GAAc,cAAe,MAAO,MAAO,EAAW,EAAW,EAAS,EAE1E,EAAW,EAAU,GAAI,GAAM,MAAO,MAAO,OAAQ,SACrD,EAAU,EAAU,GAAI,GAAM,MAAO,KAAM,OAAQ,SAEvD,GAAK,KAAK,aAAe,KAAK,YAAY,OAEzC,GAAI,GAAW,EAAU,GAAI,GAAM,MAAO,KAAM,OAAQ,SAIzD,SAAW,GAEJ,CAEN,SAAU,GAEV,IAAK,EAEL,SAAU,EACV,UAAW,EAEX,MAAO,UAAY,CAElB,EAAc,cAAe,MAAO,OAIrC,IAAK,UAAY,CAEhB,IAEA,GAAI,GAAS,cAAe,MAAO,MAInC,GAFA,EAAQ,OAAQ,EAAO,EAAW,KAE7B,GAAQ,EAAW,KAEvB,GAAS,OAAU,EAAS,IAAW,GAAO,GAAY,KAE1D,EAAW,EACX,EAAS,EAEJ,GAAW,CAEf,GAAI,GAAS,YAAY,OACzB,EAAS,OAAQ,EAAO,eAAiB,QAAS,EAAO,gBAAkB,SAM7E,MAAO,IAIR,OAAQ,UAAY,CAEnB,EAAY,KAAK,OAMlB,WAAY,EACZ,QAAS,IAMX,EAAM,MAAQ,SAAW,EAAM,EAAI,EAAK,CAEvC,GAAI,GAAM,IAAU,EAAM,EAAG,EAAQ,KAAK,MACtC,EAAK,EAAO,OAAO,kBAAoB,GAEvC,EAAQ,GAAK,EAAI,EAAS,GAAK,EAClC,EAAS,EAAI,EAAI,EAAS,EAAI,EAC9B,EAAU,EAAI,EAAI,EAAU,GAAK,EACjC,EAAc,GAAK,EAAI,EAAe,GAAK,EAExC,EAAS,SAAS,cAAe,UACrC,EAAO,MAAQ,EACf,EAAO,OAAS,EAChB,EAAO,MAAM,QAAU,yBAEvB,GAAI,GAAU,EAAO,WAAY,MACjC,SAAQ,KAAO,QAAY,EAAI,EAAO,gCACtC,EAAQ,aAAe,MAEvB,EAAQ,UAAY,EACpB,EAAQ,SAAU,EAAG,EAAG,EAAO,GAE/B,EAAQ,UAAY,EACpB,EAAQ,SAAU,EAAM,EAAQ,GAChC,EAAQ,SAAU,EAAS,EAAS,EAAa,GAEjD,EAAQ,UAAY,EACpB,EAAQ,YAAc,GACtB,EAAQ,SAAU,EAAS,EAAS,EAAa,GAE1C,CAEN,IAAK,EAEL,OAAQ,SAAW,EAAO,EAAW,CAEpC,EAAM,KAAK,IAAK,EAAK,GACrB,EAAM,KAAK,IAAK,EAAK,GAErB,EAAQ,UAAY,EACpB,EAAQ,YAAc,EACtB,EAAQ,SAAU,EAAG,EAAG,EAAO,GAC/B,EAAQ,UAAY,EACpB,EAAQ,SAAU,EAAO,GAAU,IAAM,EAAO,KAAO,EAAO,GAAQ,IAAM,EAAO,GAAQ,IAAK,EAAQ,GAExG,EAAQ,UAAW,EAAQ,EAAU,EAAI,EAAS,EAAc,EAAI,EAAc,EAAS,EAAS,EAAc,EAAI,GAEtH,EAAQ,SAAU,EAAU,EAAc,EAAI,EAAS,EAAI,GAE3D,EAAQ,UAAY,EACpB,EAAQ,YAAc,GACtB,EAAQ,SAAU,EAAU,EAAc,EAAI,EAAS,EAAI,EAAS,GAAM,EAAQ,GAAe,OAQpG,MAAe"}
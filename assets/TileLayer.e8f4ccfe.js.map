{"version":3,"file":"TileLayer.e8f4ccfe.js","sources":["../../node_modules/@arcgis/core/layers/TileLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../geometry.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import{HandleOwnerMixin as s}from\"../core/HandleOwner.js\";import{isSome as i}from\"../core/maybe.js\";import{MultiOriginJSONMixin as o}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as a}from\"../core/promiseUtils.js\";import{urlToObject as l,objectToQuery as n,makeAbsolute as p}from\"../core/urlUtils.js\";import{property as c}from\"../core/accessorSupport/decorators/property.js\";import\"../core/arrayUtils.js\";import\"../core/has.js\";import{cast as u}from\"../core/accessorSupport/decorators/cast.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as h}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import y from\"./Layer.js\";import{APIKeyMixin as f}from\"./mixins/APIKeyMixin.js\";import{ArcGISCachedService as v}from\"./mixins/ArcGISCachedService.js\";import{ArcGISMapService as g}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as S}from\"./mixins/ArcGISService.js\";import{BlendLayer as _}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as j}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as b}from\"./mixins/OperationalLayer.js\";import{PortalLayer as T}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as w}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as O}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as L}from\"./mixins/SublayersOwner.js\";import{parse as R,isHostedAgolService as x,isArcGISUrl as U}from\"./support/arcgisLayerUrl.js\";import{url as P}from\"./support/commonProperties.js\";import A from\"./support/Sublayer.js\";import W from\"../geometry/SpatialReference.js\";const I=[\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Elevation/World_Hillshade\",\"Elevation/World_Hillshade_Dark\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Ocean_Basemap\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Boundaries_and_Places_Alternate\",\"Reference/World_Transportation\",\"World_Imagery\",\"World_Street_Map\",\"World_Topo_Map\"];let M=class extends(_(L(O(b(T(v(g(S(o(s(w(f(j(y)))))))))))))){constructor(...e){super(...e),this.listMode=\"show\",this.isReference=null,this.operationalLayerType=\"ArcGISTiledMapServiceLayer\",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type=\"tile\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=i(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(a).then((()=>this._fetchService(r)))),Promise.resolve(this)}get attributionDataUrl(){var e;const r=null==(e=this.parsedUrl)?void 0:e.path.toLowerCase();return r&&this._getDefaultAttribution(this._getMapName(r))}readSpatialReference(e,r){return(e=e||r.tileInfo&&r.tileInfo.spatialReference)&&W.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray(),o=[],a={writeSublayerStructure:!1,...s};i.forEach((e=>{const r=e.write({},a);o.push(r)}));o.some((e=>Object.keys(e).length>1))&&(r.layers=o)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map((e=>l(e).path)):null}fetchTile(e,t,s,i={}){const{signal:o}=i,a=this.getTileUrl(e,t,s),l={responseType:\"image\",signal:o,query:{...this.refreshParameters}};return r(a,l).then((e=>e.data))}getTileUrl(e,r,t){const s=!this.tilemapCache&&this.supportsBlankTile,i=n({...this.parsedUrl.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),o=this.tileServers;return`${o&&o.length?o[r%o.length]:this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}_fetchService(e){return new Promise(((s,o)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");return void s({data:this.sourceJSON})}if(!this.parsedUrl)throw new t(\"tile-layer:undefined-url\",\"layer's url is not defined\");const a=R(this.parsedUrl.path);if(i(a)&&\"ImageServer\"===a.serverType)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:\"json\",signal:e}).then(s,o)})).then((r=>{if(r.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r.data,this.read(r.data,{origin:\"service\",url:this.parsedUrl}),10.1===this.version&&!x(this.url))return this._fetchServerVersion(this.url,e).then((e=>{this.read({currentVersion:e})})).catch((()=>{}))}))}_fetchServerVersion(e,s){if(!U(e))return Promise.reject();const i=e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";return r(i,{query:{f:\"json\",...this.customParameters,token:this.apiKey},responseType:\"json\",signal:s}).then((e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new t(\"tile-layer:version-not-available\")}))}_getMapName(e){const r=e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);return r&&r[2]}_getDefaultAttribution(e){if(!e)return;let r;e=e.toLowerCase();for(let t=0,s=I.length;t<s;t++)if(r=I[t],r.toLowerCase().indexOf(e)>-1)return p(\"//static.arcgis.com/attribution/\"+r)}_getDefaultTileServers(e){const r=-1!==e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),t=-1!==e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);return r||t?[e,e.replace(r?/server\\.arcgisonline/i:/services\\.arcgisonline/i,r?\"services.arcgisonline\":\"server.arcgisonline\")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};e([c({readOnly:!0})],M.prototype,\"attributionDataUrl\",null),e([c({type:[\"show\",\"hide\",\"hide-children\"]})],M.prototype,\"listMode\",void 0),e([c({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],M.prototype,\"isReference\",void 0),e([c({readOnly:!0,type:[\"ArcGISTiledMapServiceLayer\"]})],M.prototype,\"operationalLayerType\",void 0),e([c({type:Boolean})],M.prototype,\"resampling\",void 0),e([c()],M.prototype,\"sourceJSON\",void 0),e([c({type:W})],M.prototype,\"spatialReference\",void 0),e([m(\"spatialReference\",[\"spatialReference\",\"tileInfo\"])],M.prototype,\"readSpatialReference\",null),e([c({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],M.prototype,\"path\",void 0),e([c({readOnly:!0})],M.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[A]}})],M.prototype,\"writeSublayers\",null),e([c({json:{read:!1,write:!1}})],M.prototype,\"popupEnabled\",void 0),e([c()],M.prototype,\"tileServers\",null),e([u(\"tileServers\")],M.prototype,\"castTileServers\",null),e([c({readOnly:!0,json:{read:!1}})],M.prototype,\"type\",void 0),e([c(P)],M.prototype,\"url\",void 0),M=e([h(\"esri.layers.TileLayer\")],M),M.prototype.fetchTile.__isDefault__=!0;const C=M;export{C as default};\n"],"names":["_","L","O","b","T","v","g","S","o","s","w","f","j","y","r","i","a","W","l","n","t","R","x","U","p","c","m","d","A","u","P","h"],"mappings":"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"}
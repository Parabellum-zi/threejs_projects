{"version":3,"file":"MapImageLayerView3D.82719e04.js","sources":["../../node_modules/@arcgis/core/views/layers/MapImageLayerView.js","../../node_modules/@arcgis/core/views/3d/layers/MapImageLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as p}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as l}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as m}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as c}from\"./support/popupUtils.js\";import{getLayerFloorFilterClause as u}from\"../support/floorFilterUtils.js\";const y=y=>{let d=class extends y{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const i=this.get(\"view.scale\"),p=[],m=async e=>{const r=0===e.minScale||i<=e.minScale,o=0===e.maxScale||i>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(m);else if(e.popupEnabled){const r=c(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&p.unshift({sublayer:e,popupTemplate:r})}},y=a.sublayers.toArray().reverse().map(m);await Promise.all(y);const d=p.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),i=t(s)?s.event:null,p=l({renderer:r.renderer,event:i}),m=this.createFetchPopupFeaturesQueryGeometry(e,p);if(a.geometry=m,a.outFields=await n(r,o),\"map-image\"===this.layer.type&&\"floors\"in this.view){var c,y;const e=null==(c=this.view)||null==(y=c.floors)?void 0:y.clone(),o=u(e,r);t(o)&&(a.where=a.where?`(${a.where}) AND (${o})`:o)}const d=await this._loadArcadeModules(o);d&&d.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=m.width/p);return(await r.queryFeatures(a)).features}));return(await o(d)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\")||Array.isArray(e.content)&&e.content.some((e=>\"expression\"===e.type)))return m()}};return e([s()],d.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],d.prototype,\"exportImageVersion\",null),e([s()],d.prototype,\"layer\",void 0),e([s()],d.prototype,\"suspended\",void 0),e([s(i)],d.prototype,\"timeExtent\",void 0),d=e([a(\"esri.views.layers.MapImageLayerView\")],d),d};export{y as MapImageLayerView,y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/set.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{MapImageLayerView as t}from\"../../layers/MapImageLayerView.js\";import{createQueryGeometry as o}from\"../../support/drapedUtils.js\";let i=class extends(t(s)){constructor(){super(...arguments),this.type=\"map-image-3d\"}initialize(){this.updatingHandles.add(this,\"exportImageVersion\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,r){return o(e,r,this.view)}getFetchOptions(){return{timeExtent:this.timeExtent}}};i=e([r(\"esri.views.3d.layers.MapImageLayerView3D\")],i);const a=i;export{a as default};\n"],"names":["d","p","s","r","c","t","l","n","u","o","m","i","a"],"mappings":"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"}
{"version":3,"file":"ImageMaterialTechnique.ca20af60.js","sources":["../../node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js","../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as a}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as o}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{defaultMaskAlphaCutoff as i}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function s(s){const n=new l;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(t`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(e,s),s.multipassTerrainEnabled&&(n.fragment.include(a),n.include(o,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(d),n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}const n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as r}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as i,bindView as s}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as a}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as n,ShaderTechniqueConfiguration as l}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as p}from\"../lib/DefaultVertexAttributeLocations.js\";import{OITBlending as c,OITDepthTest as u,OITDepthWrite as d,getOITPolygonOffset as h}from\"../lib/OrderIndependentTransparency.js\";import{Program as m}from\"../lib/Program.js\";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as f,stencilBaseAllZerosParams as g}from\"../lib/StencilUtils.js\";import{I as y}from\"../../../../chunks/ImageMaterial.glsl.js\";import{simpleBlendingParams as T,makePipelineState as P,cullingParams as v,defaultDepthWriteParams as j,defaultColorWriteParams as S}from\"../../../webgl/renderState.js\";class E extends o{initializeProgram(e){const t=E.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m(e.rctx,i,p)}bindPass(e,t){i(this.program,t.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",t.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",t.inverseViewport),r(this.program,t))}bindDraw(e){s(this.program,e),t(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return P({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?w:c(e),culling:v(r.cullFace),depthTest:{func:u(e)},depthWrite:i?r.writeDepth&&j:d(e),colorWrite:S,stencilWrite:r.sceneHasOcludees?b:null,stencilTest:r.sceneHasOcludees?t?f:g:null,polygonOffset:i||s?null:h(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}E.shader=new a(y,(()=>import(\"./ImageMaterial.glsl.js\")));const w=T(1,771);class O extends l{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([n({count:8})],O.prototype,\"output\",void 0),e([n({count:3})],O.prototype,\"cullFace\",void 0),e([n()],O.prototype,\"slicePlaneEnabled\",void 0),e([n()],O.prototype,\"transparent\",void 0),e([n()],O.prototype,\"enableOffset\",void 0),e([n()],O.prototype,\"writeDepth\",void 0),e([n()],O.prototype,\"sceneHasOcludees\",void 0),e([n({count:4})],O.prototype,\"transparencyPassType\",void 0),e([n()],O.prototype,\"multipassTerrainEnabled\",void 0),e([n()],O.prototype,\"cullAboveGround\",void 0);export{E as ImageMaterialTechnique,O as ImageMaterialTechniqueConfiguration};\n"],"names":["l","e","o","i","d","m","p","r","s","t","P","c","v","u","j","S","b","f","g","h","a","y","T","n"],"mappings":"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"}